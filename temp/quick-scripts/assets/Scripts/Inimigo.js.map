{"version":3,"sources":["Inimigo.js"],"names":["cc","Class","extends","Component","properties","alvo","Node","dano","Float","distanciaPerseguir","distanciaAtaque","tempoVagar","direcaoVagar","Vec2","vidaMaxima","_vidaAtual","_movimentacao","_controleAnimacao","_gameOver","_tempoRestanteParaVagar","_atacando","Boolean","_vivo","onLoad","getComponent","audioMorte","AudioSource","find","node","on","sofrerDano","inicializa","reuse","UP","emit","vidaAtual","update","deltaTime","direcaoAlvo","position","sub","distancia","mag","iniciarAtaque","andar","vagar","direcao","mudaAnimacao","setDirecao","andarPraFrente","atacar","Math","random","evento","detail","morrer","mul","destruir","eventoMorte","Event","EventCustom","setUserData","dispatchEvent"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,cAAML,GAAGM,IADD;AAERC,cAAMP,GAAGQ,KAFD;AAGRC,4BAAoBT,GAAGQ,KAHf;AAIRE,yBAAiBV,GAAGQ,KAJZ;AAKRG,oBAAYX,GAAGQ,KALP;AAMRI,sBAAcZ,GAAGa,IANT;AAORC,oBAAYd,GAAGQ,KAPP;;AASRO,oBAAYf,GAAGQ,KATP;AAURQ,uBAAehB,GAAGG,SAVV;AAWRc,2BAAmBjB,GAAGG,SAXd;AAYRe,mBAAWlB,GAAGM,IAZN;AAaRa,iCAAyBnB,GAAGQ,KAbpB;AAcRY,mBAAWpB,GAAGqB,OAdN;AAeRC,eAAOtB,GAAGqB;AAfF,KAHP;;AAqBLE,YAAQ,kBAAY;AAChB,aAAKP,aAAL,GAAqB,KAAKQ,YAAL,CAAkB,cAAlB,CAArB;AACA,aAAKP,iBAAL,GAAyB,KAAKO,YAAL,CAAkB,oBAAlB,CAAzB;AACA,aAAKC,UAAL,GAAkB,KAAKD,YAAL,CAAkBxB,GAAG0B,WAArB,CAAlB;;AAEA,aAAKrB,IAAL,GAAYL,GAAG2B,IAAH,CAAQ,wBAAR,CAAZ;AACA,aAAKC,IAAL,CAAUC,EAAV,CAAa,YAAb,EAA2B,KAAKC,UAAhC,EAA4C,IAA5C;AACA,aAAKC,UAAL;AACH,KA7BI;;AA+BLC,WAAO,iBAAY;AACf,aAAKD,UAAL;AACH,KAjCI;;AAmCLA,gBAAY,sBAAY;AACpB,aAAKZ,uBAAL,GAA+B,KAAKR,UAApC;AACA,aAAKC,YAAL,GAAoBZ,GAAGa,IAAH,CAAQoB,EAA5B;;AAEA,aAAKlB,UAAL,GAAkB,KAAKD,UAAvB;AACA,aAAKM,SAAL,GAAiB,KAAjB;AACA,aAAKE,KAAL,GAAa,IAAb;;AAEA,aAAKM,IAAL,CAAUM,IAAV,CAAe,cAAf,EAA+B;AAC3BC,uBAAW,KAAKpB,UADW;AAE3BD,wBAAY,KAAKA;AAFU,SAA/B;AAIH,KA/CI;;AAiDLsB,YAAQ,gBAAUC,SAAV,EAAqB;AACzB,YAAI,KAAKf,KAAL,IAAc,CAAC,KAAKF,SAAxB,EAAmC;AAC/B,iBAAKD,uBAAL,IAAgCkB,SAAhC;AACA,gBAAIC,cAAc,KAAKjC,IAAL,CAAUkC,QAAV,CAAmBC,GAAnB,CAAuB,KAAKZ,IAAL,CAAUW,QAAjC,CAAlB;AACA,gBAAIE,YAAYH,YAAYI,GAAZ,EAAhB;;AAEA,gBAAID,YAAY,KAAK/B,eAArB,EAAsC;AAClC,qBAAKiC,aAAL,CAAmBL,WAAnB;AAEH,aAHD,MAGO,IAAIG,YAAY,KAAKhC,kBAArB,EAAyC;AAC5C,qBAAKmC,KAAL,CAAWN,WAAX;AACH,aAFM,MAEA;AACH,qBAAKO,KAAL;AACH;AACJ;AACJ,KAhEI;;AAkELD,WAAO,eAAUE,OAAV,EAAmB;AACtB,aAAK7B,iBAAL,CAAuB8B,YAAvB,CAAoCD,OAApC,EAA6C,OAA7C;AACA,aAAK9B,aAAL,CAAmBgC,UAAnB,CAA8BF,OAA9B;AACA,aAAK9B,aAAL,CAAmBiC,cAAnB;AACH,KAtEI;;AAwELN,mBAAe,uBAAUG,OAAV,EAAmB;AAC9B,aAAK7B,iBAAL,CAAuB8B,YAAvB,CAAoCD,OAApC,EAA6C,QAA7C;AACA,aAAK1B,SAAL,GAAiB,IAAjB;AACH,KA3EI;;AA6EL8B,YAAQ,gBAAUJ,OAAV,EAAmB;AACvB,aAAKzC,IAAL,CAAU6B,IAAV,CAAe,WAAf,EAA4B;AACxB3B,kBAAM,KAAKA;AADa,SAA5B;AAGA,aAAKa,SAAL,GAAiB,KAAjB;AACH,KAlFI;;AAoFLyB,WAAO,iBAAY;AACf,YAAI,KAAK1B,uBAAL,GAA+B,CAAnC,EAAsC;AAClC,iBAAKP,YAAL,GAAoB,IAAIZ,GAAGa,IAAP,CAAYsC,KAAKC,MAAL,KAAgB,GAA5B,EAChBD,KAAKC,MAAL,KAAgB,GADA,CAApB;AAEA,iBAAKjC,uBAAL,GAA+B,KAAKR,UAApC;AACH;AACD,aAAKiC,KAAL,CAAW,KAAKhC,YAAhB;AACH,KA3FI;;AA6FLkB,gBAAY,oBAAUuB,MAAV,EAAkB;AAC1B,aAAKtC,UAAL,IAAmBsC,OAAOC,MAAP,CAAc/C,IAAjC;AACA,aAAKqB,IAAL,CAAUM,IAAV,CAAe,cAAf,EAA+B;AAC3BC,uBAAW,KAAKpB,UADW;AAE3BD,wBAAY,KAAKA;AAFU,SAA/B;AAIA,YAAI,KAAKC,UAAL,GAAkB,CAAtB,EAAyB;AACrB,iBAAKwC,MAAL;AACH;AACJ,KAtGI;;AAwGLA,YAAQ,kBAAY;AAChB,aAAKtC,iBAAL,CAAuB8B,YAAvB,CAAoC/C,GAAGa,IAAH,CAAQoB,EAAR,CAAWuB,GAAX,CAAe,CAAC,CAAhB,CAApC,EAAwD,OAAxD;AACA,aAAKlC,KAAL,GAAa,KAAb;AACH,KA3GI;;AA6GLmC,cAAU,oBAAY;AAClB,aAAK7B,IAAL,CAAUM,IAAV,CAAe,YAAf;AACA,YAAIwB,cAAc,IAAI1D,GAAG2D,KAAH,CAASC,WAAb,CAAyB,aAAzB,EAAwC,IAAxC,CAAlB;AACAF,oBAAYG,WAAZ,CAAwB,KAAKjC,IAA7B;AACA,aAAKA,IAAL,CAAUkC,aAAV,CAAwBJ,WAAxB;AACH;AAlHI,CAAT","file":"Inimigo.js","sourceRoot":"..\\..\\..\\..\\assets\\Scripts","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        alvo: cc.Node,\n        dano: cc.Float,\n        distanciaPerseguir: cc.Float,\n        distanciaAtaque: cc.Float,\n        tempoVagar: cc.Float,\n        direcaoVagar: cc.Vec2,\n        vidaMaxima: cc.Float,\n\n        _vidaAtual: cc.Float,\n        _movimentacao: cc.Component,\n        _controleAnimacao: cc.Component,\n        _gameOver: cc.Node,\n        _tempoRestanteParaVagar: cc.Float,\n        _atacando: cc.Boolean,\n        _vivo: cc.Boolean,\n    },\n\n    onLoad: function () {\n        this._movimentacao = this.getComponent(\"Movimentacao\");\n        this._controleAnimacao = this.getComponent(\"ControleDeAnimacao\");\n        this.audioMorte = this.getComponent(cc.AudioSource);\n\n        this.alvo = cc.find(\"Personagens/Personagem\");\n        this.node.on(\"SofrerDano\", this.sofrerDano, this);\n        this.inicializa();\n    },\n\n    reuse: function () {\n        this.inicializa();\n    },\n\n    inicializa: function () {\n        this._tempoRestanteParaVagar = this.tempoVagar;\n        this.direcaoVagar = cc.Vec2.UP;\n\n        this._vidaAtual = this.vidaMaxima;\n        this._atacando = false;\n        this._vivo = true;\n\n        this.node.emit(\"atualizaVida\", {\n            vidaAtual: this._vidaAtual,\n            vidaMaxima: this.vidaMaxima\n        });\n    },\n\n    update: function (deltaTime) {\n        if (this._vivo && !this._atacando) {\n            this._tempoRestanteParaVagar -= deltaTime;\n            let direcaoAlvo = this.alvo.position.sub(this.node.position);\n            let distancia = direcaoAlvo.mag();\n\n            if (distancia < this.distanciaAtaque) {\n                this.iniciarAtaque(direcaoAlvo);\n\n            } else if (distancia < this.distanciaPerseguir) {\n                this.andar(direcaoAlvo);\n            } else {\n                this.vagar();\n            }\n        }\n    },\n\n    andar: function (direcao) {\n        this._controleAnimacao.mudaAnimacao(direcao, \"Andar\");\n        this._movimentacao.setDirecao(direcao);\n        this._movimentacao.andarPraFrente();\n    },\n\n    iniciarAtaque: function (direcao) {\n        this._controleAnimacao.mudaAnimacao(direcao, \"Atacar\");\n        this._atacando = true;\n    },\n\n    atacar: function (direcao) {\n        this.alvo.emit(\"SofreDano\", {\n            dano: this.dano\n        });\n        this._atacando = false;\n    },\n\n    vagar: function () {\n        if (this._tempoRestanteParaVagar < 0) {\n            this.direcaoVagar = new cc.Vec2(Math.random() - 0.5,\n                Math.random() - 0.5);\n            this._tempoRestanteParaVagar = this.tempoVagar;\n        }\n        this.andar(this.direcaoVagar)\n    },\n\n    sofrerDano: function (evento) {\n        this._vidaAtual -= evento.detail.dano;\n        this.node.emit(\"atualizaVida\", {\n            vidaAtual: this._vidaAtual,\n            vidaMaxima: this.vidaMaxima\n        });\n        if (this._vidaAtual < 0) {\n            this.morrer();\n        }\n    },\n\n    morrer: function () {\n        this._controleAnimacao.mudaAnimacao(cc.Vec2.UP.mul(-1), \"Morte\");\n        this._vivo = false;\n    },\n\n    destruir: function () {\n        this.node.emit(\"SoltarItem\");\n        let eventoMorte = new cc.Event.EventCustom(\"ZumbiMorreu\", true);\n        eventoMorte.setUserData(this.node);\n        this.node.dispatchEvent(eventoMorte);\n    }\n});"]}